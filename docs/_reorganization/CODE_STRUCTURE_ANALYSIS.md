# NLSQ Code Structure Analysis

*Generated by AST-based analysis*

**Total Modules Analyzed**: 37

## Summary Statistics

- **Total modules**: 37
- **Total classes**: 66
- **Total functions**: 100
- **Total methods**: 401
- **Total constants**: 54

### Docstring Coverage

- **Modules**: 33/37 (89%)
- **Classes**: 65/66 (98%)
- **Functions**: 95/100 (95%)
- **Methods**: 367/401 (91%)
- **Overall callables**: 462/501 (92%)

## Public API Analysis

- **Modules with `__all__`**: 12/37
- **Public classes** (not starting with `_`): 66
- **Exported classes** (in `__all__`): 22
- **Public functions** (not starting with `_`): 98
- **Exported functions** (in `__all__`): 20

### Modules with Explicit Exports (`__all__`)

- **__init__.py**: 73 exports
- **_version.py**: 6 exports
- **bound_inference.py**: 3 exports
- **callbacks.py**: 6 exports
- **constants.py**: 32 exports
- **fallback.py**: 3 exports
- **functions.py**: 7 exports
- **large_dataset.py**: 8 exports
- **minpack.py**: 2 exports
- **profiler.py**: 4 exports
- **profiler_visualization.py**: 2 exports
- **stability.py**: 7 exports

## Sphinx Documentation Comparison

**Modules documented in Sphinx**: 10/34

### Documented in Sphinx API

- `caching.py` ✓
- `common_jax.py` ✓
- `common_scipy.py` ✓
- `config.py` ✓
- `least_squares.py` ✓
- `logging.py` ✓
- `loss_functions.py` ✓
- `minpack.py` ✓
- `optimizer_base.py` ✓
- `trf.py` ✓

### NOT Documented in Sphinx API

These modules exist in the codebase but are not in `docs/api/`:

- `algorithm_selector.py` [MEDIUM priority] - 2 public items
- `bound_inference.py` [HIGH priority] - 4 public items
- `callbacks.py` [HIGH priority] - 6 public items
- `compilation_cache.py` [MEDIUM priority] - 4 public items
- `constants.py` [HIGH priority] - 0 public items
- `diagnostics.py` [MEDIUM priority] - 4 public items
- `error_messages.py` [MEDIUM priority] - 6 public items
- `fallback.py` [HIGH priority] - 9 public items
- `functions.py` [HIGH priority] - 15 public items
- `large_dataset.py` [HIGH priority] - 8 public items
- `memory_manager.py` [MEDIUM priority] - 4 public items
- `memory_pool.py` [MEDIUM priority] - 4 public items
- `parameter_estimation.py` [MEDIUM priority] - 3 public items
- `profiler.py` [HIGH priority] - 5 public items
- `profiler_visualization.py` [HIGH priority] - 2 public items
- `recovery.py` [MEDIUM priority] - 1 public items
- `result.py` [MEDIUM priority] - 1 public items
- `robust_decomposition.py` [MEDIUM priority] - 1 public items
- `smart_cache.py` [MEDIUM priority] - 7 public items
- `sparse_jacobian.py` [MEDIUM priority] - 3 public items
- `stability.py` [HIGH priority] - 6 public items
- `streaming_optimizer.py` [MEDIUM priority] - 5 public items
- `svd_fallback.py` [MEDIUM priority] - 4 public items
- `validators.py` [MEDIUM priority] - 2 public items

## Module Breakdown

### `__init__.py`

**Status**: ✓ Docstring | ✓ __all__ (73)

**Description**: NLSQ: JAX-accelerated nonlinear least squares curve fitting.  GPU/TPU-accelerated curve fitting with automatic differentiation. Provides drop-in SciPy...

**Exports (`__all__`)**: 73 items
```python
# First 10 of 73 exports:
  'AlgorithmSelector',
  'callbacks',
  'functions',
  'CompilationCache',
  'ConvergenceMonitor',
  'CurveFit',
  'DataGenerator',
  'InputValidator',
  'LargeDatasetConfig',
  'LargeDatasetFitter',
  # ... and 63 more
```

**Functions**: 1 total, 1 public

---

### `_optimize.py`

**Status**: ✗ No docstring

**Classes**: 2 total, 2 public

---

### `_version.py`

**Status**: ✗ No docstring | ✓ __all__ (6)

**Exports (`__all__`)**: 6 items
```python
  '__commit_id__',
  '__version__',
  '__version_tuple__',
  'commit_id',
  'version',
  'version_tuple',
```

**Constants**: 1
- `TYPE_CHECKING` (line 13)

---

### `algorithm_selector.py`

**Status**: ✓ Docstring | ✗ No Sphinx

**Description**: Automatic algorithm selection for NLSQ optimization.  This module analyzes problem characteristics and automatically selects the best optimization alg...

**Classes**: 1 total, 1 public

**Functions**: 1 total, 1 public

---

### `bound_inference.py`

**Status**: ✓ Docstring | ✗ No Sphinx | ✓ __all__ (3)

**Description**: Smart Parameter Bounds Inference =================================  This module provides automatic inference of reasonable parameter bounds based on d...

**Exports (`__all__`)**: 3 items
```python
  'BoundsInference',
  'infer_bounds',
  'merge_bounds',
```

**Classes**: 1 total, 1 public

**Functions**: 3 total, 3 public

---

### `caching.py`

**Status**: ✓ Docstring | ✓ Sphinx

**Description**: Function caching mechanism for NLSQ to avoid JAX recompilation.

**Classes**: 1 total, 1 public

**Functions**: 5 total, 5 public

---

### `callbacks.py`

**Status**: ✓ Docstring | ✗ No Sphinx | ✓ __all__ (6)

**Description**: Progress callbacks for monitoring optimization iterations.  This module provides built-in callbacks for monitoring curve_fit optimization progress, in...

**Exports (`__all__`)**: 6 items
```python
  'CallbackBase',
  'CallbackChain',
  'EarlyStopping',
  'IterationLogger',
  'ProgressBar',
  'StopOptimization',
```

**Classes**: 6 total, 6 public

---

### `common_jax.py`

**Status**: ✓ Docstring | ✓ Sphinx

**Description**: These are functions that were initially in the common.py file, but are have large data operations and are therefore better suited to be compiled with ...

**Constants**: 1
- `EPS` (line 17)

**Classes**: 1 total, 1 public

---

### `common_scipy.py`

**Status**: ✓ Docstring | ✓ Sphinx

**Description**: Functions used by least-squares algorithms. Those functions that involve large computations are reimplemented in the common_jax.py file using JAX.

**Constants**: 1
- `EPS` (line 14)

**Functions**: 17 total, 17 public

---

### `compilation_cache.py`

**Status**: ✓ Docstring | ✗ No Sphinx

**Description**: JIT compilation cache for optimization functions.  This module provides caching of compiled JAX functions to avoid recompilation overhead.

**Classes**: 1 total, 1 public

**Functions**: 3 total, 3 public

---

### `config.py`

**Status**: ✓ Docstring | ✓ Sphinx

**Description**: Central configuration management for NLSQ package.

**Classes**: 3 total, 3 public

**Functions**: 10 total, 10 public

---

### `constants.py`

**Status**: ✓ Docstring | ✗ No Sphinx | ✓ __all__ (32)

**Description**: Constants for NLSQ optimization algorithms.  These values are derived from: - SciPy's trust-region algorithms - Numerical optimization best practices ...

**Exports (`__all__`)**: 32 items
```python
# First 10 of 32 exports:
  'DEFAULT_FTOL',
  'DEFAULT_F_SCALE',
  'DEFAULT_GTOL',
  'DEFAULT_MAX_NFEV_MULTIPLIER',
  'DEFAULT_MEMORY_LIMIT_GB',
  'DEFAULT_XTOL',
  'FINITE_DIFF_ABS_STEP_MIN',
  'FINITE_DIFF_REL_STEP',
  'HUBER_LOSS_THRESHOLD',
  'INITIAL_LEVENBERG_MARQUARDT_LAMBDA',
  # ... and 22 more
```

**Constants**: 32
- `DEFAULT_MAX_NFEV_MULTIPLIER` (line 14)
- `STEP_ACCEPTANCE_THRESHOLD` (line 17)
- `STEP_QUALITY_EXCELLENT` (line 19)
- `STEP_QUALITY_GOOD` (line 21)
- `INITIAL_TRUST_RADIUS` (line 24)
- ... and 27 more

---

### `diagnostics.py`

**Status**: ✓ Docstring | ✗ No Sphinx

**Description**: Optimization diagnostics and monitoring for NLSQ.  This module provides real-time monitoring, convergence detection, and diagnostic reporting for opti...

**Classes**: 2 total, 2 public

**Functions**: 2 total, 2 public

---

### `error_messages.py`

**Status**: ✓ Docstring | ✗ No Sphinx

**Description**: Enhanced error messages with diagnostics and recommendations.  This module provides informative error messages that help users debug optimization fail...

**Classes**: 3 total, 3 public

**Functions**: 3 total, 3 public

---

### `fallback.py`

**Status**: ✓ Docstring | ✗ No Sphinx | ✓ __all__ (3)

**Description**: Automatic Fallback Strategies for Robust Optimization ======================================================  This module provides automatic fallback ...

**Exports (`__all__`)**: 3 items
```python
  'FallbackOrchestrator',
  'FallbackResult',
  'FallbackStrategy',
```

**Classes**: 9 total, 9 public

---

### `functions.py`

**Status**: ✓ Docstring | ✗ No Sphinx | ✓ __all__ (7)

**Description**: Common curve fitting functions with automatic parameter estimation.  This module provides pre-built functions for common curve fitting tasks. Each fun...

**Exports (`__all__`)**: 7 items
```python
  'exponential_decay',
  'exponential_growth',
  'gaussian',
  'linear',
  'polynomial',
  'power_law',
  'sigmoid',
```

**Functions**: 15 total, 15 public

---

### `large_dataset.py`

**Status**: ✓ Docstring | ✗ No Sphinx | ✓ __all__ (8)

**Description**: Large Dataset Fitting Module for NLSQ.  This module provides utilities for efficiently fitting curve parameters to very large datasets (>10M points) w...

**Exports (`__all__`)**: 8 items
```python
  'DataChunker',
  'DatasetStats',
  'LDMemoryConfig',
  'LargeDatasetFitter',
  'MemoryEstimator',
  'ProgressReporter',
  'estimate_memory_requirements',
  'fit_large_dataset',
```

**Classes**: 6 total, 6 public

**Functions**: 2 total, 2 public

---

### `least_squares.py`

**Status**: ✓ Docstring | ✓ Sphinx

**Description**: Generic interface for least-squares minimization.

**Constants**: 1
- `TERMINATION_MESSAGES` (line 25)

**Classes**: 2 total, 2 public

**Functions**: 3 total, 3 public

---

### `logging.py`

**Status**: ✓ Docstring | ✓ Sphinx

**Description**: Comprehensive logging system for NLSQ package.

**Classes**: 2 total, 2 public

**Functions**: 4 total, 4 public

---

### `loss_functions.py`

**Status**: ✗ No docstring | ✓ Sphinx

**Classes**: 1 total, 1 public

---

### `memory_manager.py`

**Status**: ✓ Docstring | ✗ No Sphinx

**Description**: Memory management for NLSQ optimization.  This module provides intelligent memory management capabilities including prediction, monitoring, pooling, a...

**Classes**: 1 total, 1 public

**Functions**: 3 total, 3 public

---

### `memory_pool.py`

**Status**: ✓ Docstring | ✗ No Sphinx

**Description**: Memory pool for optimization algorithms.  This module provides memory pool allocation to reduce overhead from repeated array allocations in optimizati...

**Classes**: 2 total, 2 public

**Functions**: 2 total, 2 public

---

### `minpack.py`

**Status**: ✗ No docstring | ✓ Sphinx | ✓ __all__ (2)

**Exports (`__all__`)**: 2 items
```python
  'CurveFit',
  'curve_fit',
```

**Classes**: 1 total, 1 public

**Functions**: 2 total, 1 public

---

### `optimizer_base.py`

**Status**: ✓ Docstring | ✓ Sphinx

**Description**: Base class for optimization algorithms in NLSQ.

**Classes**: 2 total, 2 public

---

### `parameter_estimation.py`

**Status**: ✓ Docstring | ✗ No Sphinx

**Description**: Automatic initial parameter estimation for curve fitting.  This module provides intelligent parameter estimation when users don't provide initial gues...

**Functions**: 3 total, 3 public

---

### `profiler.py`

**Status**: ✓ Docstring | ✗ No Sphinx | ✓ __all__ (4)

**Description**: Performance Profiling for NLSQ ================================  Comprehensive performance profiling system for tracking and analyzing optimization pe...

**Exports (`__all__`)**: 4 items
```python
  'PerformanceProfiler',
  'ProfileMetrics',
  'clear_profiling_data',
  'get_global_profiler',
```

**Classes**: 3 total, 3 public

**Functions**: 2 total, 2 public

---

### `profiler_visualization.py`

**Status**: ✓ Docstring | ✗ No Sphinx | ✓ __all__ (2)

**Description**: Performance Profiling Visualization ====================================  Visualization and dashboard tools for NLSQ performance profiling data.

**Exports (`__all__`)**: 2 items
```python
  'ProfilerVisualization',
  'ProfilingDashboard',
```

**Classes**: 2 total, 2 public

---

### `recovery.py`

**Status**: ✓ Docstring | ✗ No Sphinx

**Description**: Recovery strategies for optimization failures.  This module provides automatic recovery mechanisms for handling optimization failures with multiple re...

**Classes**: 1 total, 1 public

---

### `result.py`

**Status**: ✓ Docstring | ✗ No Sphinx

**Description**: Enhanced result objects for curve fitting with convenience methods.

**Classes**: 1 total, 1 public

---

### `robust_decomposition.py`

**Status**: ✓ Docstring | ✗ No Sphinx

**Description**: Robust matrix decomposition with multi-level fallback strategies.  This module extends the SVD fallback to provide comprehensive fallback strategies f...

**Classes**: 1 total, 1 public

---

### `smart_cache.py`

**Status**: ✓ Docstring | ✗ No Sphinx

**Description**: Smart caching system for NLSQ optimization.  This module provides intelligent caching for expensive computations, particularly Jacobian evaluations an...

**Classes**: 2 total, 2 public

**Functions**: 5 total, 5 public

---

### `sparse_jacobian.py`

**Status**: ✓ Docstring | ✗ No Sphinx

**Description**: Sparse Jacobian support for large-scale optimization.  This module provides sparse matrix support for Jacobian computations, enabling efficient handli...

**Classes**: 2 total, 2 public

**Functions**: 1 total, 1 public

---

### `stability.py`

**Status**: ✓ Docstring | ✗ No Sphinx | ✓ __all__ (7)

**Description**: Numerical stability management for NLSQ optimization.  This module provides comprehensive numerical stability monitoring and correction capabilities f...

**Exports (`__all__`)**: 7 items
```python
  'NumericalStabilityGuard',
  'apply_automatic_fixes',
  'check_problem_stability',
  'detect_collinearity',
  'detect_parameter_scale_mismatch',
  'estimate_condition_number',
  'stability_guard',
```

**Classes**: 1 total, 1 public

**Functions**: 5 total, 5 public

---

### `streaming_optimizer.py`

**Status**: ✓ Docstring | ✗ No Sphinx

**Description**: Streaming optimizer for datasets that don't fit in memory.  This module provides true streaming optimization that can handle datasets of unlimited siz...

**Classes**: 3 total, 3 public

**Functions**: 2 total, 2 public

---

### `svd_fallback.py`

**Status**: ✓ Docstring | ✗ No Sphinx

**Description**: SVD computation with GPU/CPU fallback for robustness.

**Functions**: 4 total, 4 public

---

### `trf.py`

**Status**: ✓ Docstring | ✓ Sphinx

**Description**: Trust Region Reflective algorithm for least-squares optimization. The algorithm is based on ideas from paper [STIR]_. The main idea is to account for ...

**Constants**: 6
- `TR_REDUCTION_FACTOR` (line 146)
- `TR_BOUNDARY_THRESHOLD` (line 147)
- `LOSS_FUNCTION_COEFF` (line 148)
- `SQRT_EXPONENT` (line 149)
- `NUMERICAL_ZERO_THRESHOLD` (line 152)
- ... and 1 more

**Classes**: 2 total, 2 public

---

### `validators.py`

**Status**: ✓ Docstring | ✗ No Sphinx

**Description**: Input validation for NLSQ optimization functions.  This module provides comprehensive input validation to catch errors early and provide helpful error...

**Classes**: 1 total, 1 public

**Functions**: 1 total, 1 public

---

## Documentation Gaps

### Modules without docstrings (2)

- `loss_functions.py`
- `minpack.py` [2 exports]

### Public classes without docstrings (1)

- `OptimizeWarning` in `_optimize.py`

### Public functions without docstrings (4)

- `print_header_nonlinear()` in `common_scipy.py`
- `print_iteration_nonlinear()` in `common_scipy.py`
- `print_header_linear()` in `common_scipy.py`
- `print_iteration_linear()` in `common_scipy.py`

### Public methods without docstrings (17)

Excluding `__init__`, `__repr__`, `__str__`:

- `CommonJIT.create_quadratic_funcs()` in `common_jax.py`
- `LossFunctionsJIT.create_stack_rhos()` in `loss_functions.py`
- `LossFunctionsJIT.get_empty_rhos()` in `loss_functions.py`
- `LossFunctionsJIT.create_huber_funcs()` in `loss_functions.py`
- `LossFunctionsJIT.huber()` in `loss_functions.py`
- `LossFunctionsJIT.create_soft_l1_funcs()` in `loss_functions.py`
- `LossFunctionsJIT.soft_l1()` in `loss_functions.py`
- `LossFunctionsJIT.create_cauchy_funcs()` in `loss_functions.py`
- `LossFunctionsJIT.cauchy()` in `loss_functions.py`
- `LossFunctionsJIT.create_arctan_funcs()` in `loss_functions.py`
- `LossFunctionsJIT.arctan()` in `loss_functions.py`
- `LossFunctionsJIT.create_zscale()` in `loss_functions.py`
- `LossFunctionsJIT.create_calculate_cost()` in `loss_functions.py`
- `LossFunctionsJIT.create_scale_rhos()` in `loss_functions.py`
- `LossFunctionsJIT.construct_single_loss_function()` in `loss_functions.py`
- `LossFunctionsJIT.construct_all_loss_functions()` in `loss_functions.py`
- `LossFunctionsJIT.get_loss_function()` in `loss_functions.py`

## Decorator Usage Analysis

| Decorator | Count |
|-----------|-------|
| `@property` | 13 |
| `@classmethod` | 9 |
| `@contextmanager` | 7 |
| `@staticmethod` | 5 |
| `@cache` | 1 |
| `@abstractmethod` | 1 |
| `@trust_radius.setter` | 1 |
| `@with_cpu_fallback` | 1 |

## Recommendations

### Priority 1: Critical Documentation Gaps

1. **Add module docstrings** to 2 modules:
   - `loss_functions.py` (1 public items)
   - `minpack.py` (2 public items)

2. **Add to Sphinx documentation** (22 modules):
   - `algorithm_selector.py` [MEDIUM] (2 public items)
   - `bound_inference.py` [HIGH] (3 exports)
   - `callbacks.py` [HIGH] (6 exports)
   - `compilation_cache.py` [MEDIUM] (4 public items)
   - `constants.py` [HIGH] (32 exports)
   - `diagnostics.py` [MEDIUM] (4 public items)
   - `error_messages.py` [MEDIUM] (6 public items)
   - `fallback.py` [HIGH] (3 exports)
   - `functions.py` [HIGH] (7 exports)
   - `large_dataset.py` [HIGH] (8 exports)
   - ... and 12 more

### Priority 2: Public API Documentation

1. Document all items in `__all__` exports (these are the official public API)
2. Add complete docstrings with:
   - Description of purpose
   - Parameters with types
   - Return values
   - Examples (where appropriate)
   - Raises section for exceptions

### Priority 3: Type Hints

- Current type hint coverage: 66/98 (67%) public functions
- Consider adding type hints to improve:
  - IDE autocomplete and type checking
  - Static analysis with mypy
  - Documentation generation
  - Error detection before runtime

### Priority 4: Consistency

1. Ensure all modules have `__all__` exports (currently only 12/34)
2. Use consistent docstring formats (NumPy style is recommended)
3. Add examples to complex functions and classes
