# ==============================================================================
# Custom Model Fitting Workflow (Damped Oscillator)
# ==============================================================================
# This workflow demonstrates using a custom model defined in a Python file.
#
# Model: y = A * exp(-gamma * t) * cos(omega * t + phi)
#
# This example shows:
# - Loading custom models from external Python files
# - Using estimate_p0 for automatic initial parameter estimation
# - Using bounds() for default parameter constraints
#
# Usage:
#   nlsq fit workflows/04_custom_model.yaml
# ==============================================================================

metadata:
  workflow_name: damped_oscillator_fit
  description: Damped sinusoidal oscillator fitting with custom model
  dataset_id: oscillator_001

# ==============================================================================
# Data Configuration
# ==============================================================================
data:
  input_file: data/damped_oscillation.csv
  format: csv

  columns:
    x: time
    y: amplitude
    sigma: sigma

  csv:
    delimiter: ","
    header: true

# ==============================================================================
# Model Configuration
# ==============================================================================
# Custom model with automatic parameter estimation
model:
  type: custom
  path: models/custom_models.py
  function: damped_oscillator

  # Enable automatic initial parameter estimation
  # Uses estimate_p0() function from the model file
  auto_p0: true

  # Enable automatic bounds
  # Uses bounds() function from the model file
  auto_bounds: true

# ==============================================================================
# Fitting Configuration
# ==============================================================================
fitting:
  method: trf

  # Override auto_p0 with explicit guess (optional)
  # p0: [5.0, 0.1, 2.0, 0.5]  # [amplitude, decay, frequency, phase]

  # Override auto_bounds with explicit bounds (optional)
  # bounds:
  #   lower: [0.0, 0.0, 0.0, -6.28]
  #   upper: [10.0, 1.0, 10.0, 6.28]

  # Convergence tolerances
  ftol: 1.0e-10
  xtol: 1.0e-10
  gtol: 1.0e-10

  absolute_sigma: true

# ==============================================================================
# Export Configuration
# ==============================================================================
export:
  results_file: output/damped_oscillator_results.json
  format: json

  include:
    parameters: true
    covariance: true
    uncertainties: true
    statistics: true
    convergence_info: true

visualization:
  enabled: false
