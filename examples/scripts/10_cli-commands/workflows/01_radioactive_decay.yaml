# ==============================================================================
# Radioactive Decay Fitting Workflow
# ==============================================================================
# This workflow demonstrates fitting radioactive decay data to determine
# the decay constant and initial activity using the NLSQ CLI.
#
# Model: N(t) = N0 * exp(-lambda * t)
#
# Usage:
#   nlsq fit workflows/01_radioactive_decay.yaml
#   nlsq fit workflows/01_radioactive_decay.yaml --output output/my_results.json
#   nlsq fit workflows/01_radioactive_decay.yaml --stdout | jq '.popt'
# ==============================================================================

metadata:
  workflow_name: radioactive_decay_fit
  description: Fit radioactive decay curve to determine half-life
  dataset_id: carbon14_example

# ==============================================================================
# Data Configuration
# ==============================================================================
data:
  # Path to data file (relative to current working directory)
  input_file: data/radioactive_decay.csv
  format: csv

  # Column mapping (0-indexed or column names)
  columns:
    x: time           # Time in years
    y: activity       # Activity in counts/min
    sigma: sigma      # Measurement uncertainty

  # CSV-specific options
  csv:
    delimiter: ","
    header: true

# ==============================================================================
# Model Configuration
# ==============================================================================
model:
  # Use builtin exponential_decay model: a*exp(-b*x) + c
  type: builtin
  name: exponential_decay

  # Auto-estimate initial parameters from data
  auto_p0: true

# ==============================================================================
# Fitting Configuration
# ==============================================================================
fitting:
  method: trf  # Trust Region Reflective algorithm

  # Override auto_p0 with explicit initial guess (optional)
  # p0: [1000.0, 0.0001, 0.0]

  # Parameter bounds
  bounds:
    lower: [0, 0, -100]      # N0 >= 0, lambda >= 0
    upper: [2000, 0.01, 100] # Reasonable upper limits

  # Convergence tolerances
  ftol: 1.0e-10
  xtol: 1.0e-10
  gtol: 1.0e-10

  # Use absolute sigma for proper uncertainty estimation
  absolute_sigma: true

# ==============================================================================
# Export Configuration
# ==============================================================================
export:
  results_file: output/radioactive_decay_results.json
  format: json

  include:
    parameters: true
    covariance: true
    uncertainties: true
    statistics: true
    convergence_info: true

# ==============================================================================
# Visualization (Optional)
# ==============================================================================
visualization:
  enabled: false  # Set to true to generate plots
  output_dir: output/figures
  formats:
    - png
